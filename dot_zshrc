POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi


# Set the directory we want to store zinit and plugins
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"

# Download Zinit, if it's not there yet
if [ ! -d "$ZINIT_HOME" ]; then
    mkdir -p "$(dirname $ZINIT_HOME)"
    git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
fi

# Source/Load Zinit
source "${ZINIT_HOME}/zinit.zsh"

# ### Added by Zinit's installer
# if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
#     print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})…%f"
#     command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
#     command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
#         print -P "%F{33} %F{34}Installation successful.%f%b" || \
#         print -P "%F{160} The clone has failed.%f%b"
# fi
#
# source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
# autoload -Uz _zinit
# (( ${+_comps} )) && _comps[zinit]=_zinit


# Add in Powerlevel10k
zinit ice depth=1; zinit light romkatv/powerlevel10k

# Add in zsh plugins
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-completions
zinit light zsh-users/zsh-autosuggestions
zinit light Aloxaf/fzf-tab

# Add in snippets
zinit snippet OMZP::git
zinit snippet OMZP::sudo
zinit snippet OMZP::archlinux
zinit snippet OMZP::aws
zinit snippet OMZP::kubectl
zinit snippet OMZP::kubectx
zinit snippet OMZP::command-not-found


# Auto load zsh-completion on start
autoload -U compinit && compinit -u 

zinit cdreplay -q

# History
HISTSIZE=5000
HISTFILE="$HOME/.zsh_history"
SAVEHIST=$HISTSIZE
HISTDUP=erase

setopt appendhistory
setopt sharehistory
setopt hist_ignore_space
setopt hist_ignore_all_dups
setopt hist_save_no_dups
setopt hist_ignore_dups
setopt hist_find_no_dups

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
# [[ -f "$HOME"/.p10k.zsh ]] && source "$HOME"/.p10k.zsh; echo "sourced p10k"

# Keybindings
# bindkey '^f' autosuggest-accept
bindkey -e # emacs mode
bindkey '^p' history-search-backward
bindkey '^n' history-search-forward

# Completion styling
zstyle ':completion:*' matcher_list 'm:{a-z}={A-Za-z}' # match case insensitive
# LS_COLORS='no=00;37:fi=00:di=00;33:ln=04;36:pi=40;33:so=01;35:bd=40;33;01:'
# export LS_COLORS
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*' menu no
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'ls --color $realpath'
zstyle ':fzf-tab:complete:__zoxide_z:*' fzf-preview 'ls --color $realpath'


# Aliases
alias ls='ls --color'

alias zshrc='source $HOME/.zshrc'
alias reload='source $HOME/.zshrc'
alias editrc='nvim $HOME/.zshrc'

alias ls='ls -GFhsh'
alias mkdir='mkdir -p'
alias distro='cat /etc/*-release'
alias myip='curl http://ipecho.net/plain; echo'
alias zshconfig='subl $HOME/.zshrc'

alias server='python -m SimpleHTTPServer 8000'
alias npmhelp='chrome https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/npm'
alias suidocs='chrome https://splunkui.splunkeng.com/'

alias show_remap='nvim $HOME/.config/nvim/lua/glouie/remap.lua'

export HOMEBREW_REPOSITORY=/home/linuxbrew/.linuxbrew/Homebrew
# eval "$(brew shellenv)"
eval $("$HOMEBREW_REPOSITORY"/bin/brew shellenv)

# Shell integrations
eval "$(fzf --zsh)"
eval "$(zoxide init --cmd cd zsh)"


######################## START ZSH ########################
# install brew:
# ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
#
# macOS: install XCode Command Line Tool
# $ xcode-select —-install
#
# Run the following command to install ZSH. It gets installed at /usr/local/bin/zsh PS: Mac’s default ZSH is at /bin/zsh
# brew install zsh
#
# Change the default shell
# chsh -s /usr/local/bin/zsh

# Install home brew if not found.
if ! type "brew" > /dev/null; then
    echo "brew was not found. Installing homebrew..."
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# Install omg zsh from homebrew to use. Instead of the default zsh.
if ! type "zsh" > /dev/null; then
    echo "zsh was not found. Installing zsh from homebrew..."
    brew install zsh

    echo "Change the shell to the homebrew zsh."
    chsh -s zsh
    echo "Logout and Log back in."
fi

# Check to see that we are using the right zsh.
if [ ! `which zsh` = "$HOMEBREW_REPOSITORY"/bin/zsh ]; then
    echo "Note: you are not using the homebrew zsh"
fi

# Install Oh My ZSH
# https://github.com/ohmyzsh/ohmyzsh#manual-installation
#
# git clone https://github.com/ohmyzsh/ohmyzsh.git ~/.oh-my-zsh
# plugins=(git)
#
# source $ZSH/oh-my-zsh.sh
#

########################  END ZSH  ########################


#<!-- START ORCA ALIAS -->
unalias orca 2>/dev/null
unalias orca_ssh 2>/dev/null
unalias orca_dev 2>/dev/null
unalias orca_debug_sh 2>/dev/null

latest_check() {
       # 1st argument is the repo to compare against, dev or prod
        repotarget=""
        shorttarget=""
        if [ "$1" = "dev" ]; then
          repotarget="repo.splunk.com/splunk/products/orca/branches/develop"
          shorttarget="splunk/products/orca/branches/develop"
        else
          repotarget="repo.splunk.com/splunk/products/orca"
          shorttarget="splunk/products/orca "
        fi
        fulltarget=$repotarget":latest"
        LOCAL_SHA=$(docker images --digests | grep "${repotarget}\s" | grep latest | awk -F' ' '{print$3}')
        REMOTE=$(ping -c 1 -t 3 repo.splunk.com 2>/dev/null)
        if [[ "$REMOTE" = *"0 packets received"* || "$REMOTE" = *"Unknown host"* || "$REMOTE" = "" ]]; then
          echo Connection to repo.splunk.com failed! Unable to check 'latest' image version.
        else
          command='curl -s "https://repo.splunk.com/artifactory/ui/views/dockerv2" -XPOST -H "Content-Type: application/json;charset=UTF-8" -H "Request-Agent: artifactoryUI" --data-binary '\''{"view":"dockerv2","repoKey":"docker-solutions-local","path":"'$shorttarget"/latest"'"}'\'' | python -c "from __future__ import print_function; import sys, json; print (json.load(sys.stdin)['\''tagInfo'\'']['\''digest'\''])"'
           REMOTE_SHA=$(eval $command)
           if [ "$LOCAL_SHA" != "$REMOTE_SHA" ]; then
             while true; do
               read "yn?There is a new version available for ORCA. Would you like to upgrade? [y/n] "
                 case $yn in
                   [Yy]* ) docker pull $fulltarget;
                           if [ $? -eq 0 ]; then
                                echo "Your local 'latest' ORCA image is up to date!";
                            else
                                echo "Error pulling 'latest' ORCA image";
                            fi
                     break;;
                   [Nn]* ) break;;
                   * ) echo 'Please enter yes or no.';;
                 esac
             done
             while true; do
               read "yn?Do you wish to remove old ORCA images? [y/n] "
                 case $yn in
                   [Yy]* ) docker images | grep $repotarget | awk -F' ' '{print$3}' | tail -n+4 | xargs docker rmi -f
                     echo "All ORCA images except the latest 3 have been removed!";
                     echo "Kept images:";
                     docker images | grep $repotarget;
                     echo;
                     break;;
                   [Nn]* ) break;;
                   * ) echo 'Please enter yes or no.';;
                 esac
              done
           fi
        fi
};

orca() {
    latest_check
    docker run --rm -it -e USER=$USER -e HOST_HOME=$HOME \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -v $HOME/.orca:/root/.orca \
        -v $HOME/.docker:/root/.docker \
        -v "$(pwd -P)":/orca-home repo.splunk.com/splunk/products/orca:latest \
        "$@"
};

orca_ssh() {
    latest_check
    docker run --rm -it -e USER=$USER -e HOST_HOME=$HOME \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -v $HOME/.orca:/root/.orca \
        -v $HOME/.ssh:/root/.ssh \
        -v $HOME/.docker:/root/.docker \
        -v "$(pwd -P)":/orca-home repo.splunk.com/splunk/products/orca:latest \
        "$@"
};

orca_dev() {
    latest_check dev
    docker run --rm -it -e USER=$USER -e HOST_HOME=$HOME \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -v $HOME/.orca:/root/.orca \
        -v $HOME/.docker:/root/.docker \
        -v "$(pwd -P)":/orca-home repo.splunk.com/splunk/products/orca/branches/develop:latest \
        "$@"
};

orca_debug_sh() {
    latest_check
    docker run --rm -it -e USER=$USER -e HOST_HOME=$HOME \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -v $HOME/.orca:/root/.orca \
        -v $HOME/.docker:/root/.docker \
        --entrypoint /bin/sh \
        -v "$(pwd -P)":/orca-home repo.splunk.com/splunk/products/orca:latest \
        "$@"
};

orca_beta() {
    latest_check
    docker run --rm -it -e USER=$USER -e HOST_HOME=$HOME \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -v $HOME/.orca:/root/.orca \
        -v $HOME/.docker:/root/.docker \
        -v "$(pwd -P)":/orca-home repo.splunk.com/splunk/products/orca:beta \
        "$@"
};

update_orca_alias() {
    sed -i '' '/#<!-- START ORCA ALIAS -->/,/#<!-- END ORCA ALIAS -->\n/d' $HOME/.zshrc
    curl -s https://repo.splunk.com/artifactory/Solutions/Common/misc/orca_zsh.sh >> $HOME/.zshrc
    echo "Please run 'source $HOME/.zshrc' or restart your shell."
};

update_orca_nfr_license() {
    curl -L -o $HOME/.orca/nfr_enterprise.lic http://go.splunk.com/splunk-nfr-license
};
#<!-- END ORCA ALIAS -->

###### Start Virtualenv #########

# Get Virtual Env
if [[ $VIRTUAL_ENV != "" ]]
then
    # Strip out the path and just leave the env name
    # venv="${RED}(${VIRTUAL_ENV##*/})$ORIGINAL"
    venv="::${VIRTUAL_ENV##*/}:: "
else
    # In case you don't have one activated
    alias pipi='pip3.8 install -i https://repo.splunk.com/artifactory/api/pypi/pypi-local/simple --extra-index-url https://pypi.python.org/simple'
    venv=''
fi

alias splunkqa='deactivate; source $HOME/.zshrc; source $HOME/venv/splunkqa/bin/activate; export REPO=$HOME/gitlab/main/qa; cdr'
alias minnow='deactivate; source $HOME/.zshrc; source $HOME/venv/minnow/bin/activate; export REPO=$HOME/gitlab/minnow; cdr'
alias htmlwd='deactivate; source $HOME/.zshrc; source $HOME/venv/htmlwd/bin/activate; export REPO=$HOME/gitlab/html-webdriver; cdr'
alias dataanalysis='deactivate; source $HOME/.zshrc; source $HOME/venv/dataanalysis/bin/activate; export REPO=$HOME/gitlab/data-analysis; cdr; export TEST_DIR=$REPO/test/ui'
alias sui='deactivate; source $HOME/.zshrc; source $HOME/venv/splunkui/bin/activate; export REPO=$HOME/gitlab/splunk-ui-test-functional; cdr; export TEST_DIR=$REPO'

alias pipi='pip3.8 install -i https://repo.splunkdev.ne/artifactory/api/pypi/pypi-local/simple --extra-index-url https://pypi.python.org/simple'
# alias pipi='pip3.8 install -i https://repo.splunk.com/artifactory/api/pypi/pypi-local/simple --extra-index-url https://pypi.python.org/simple'
alias pip-uninstall-all='pip3.8 freeze | grep -v "^-e" | grep -v "@" | xargs pip3.8 uninstall -y'
alias pip='pip3.8'

alias cleansplunkqa='deactivate; virtualenv --clear $HOME/venv/splunkqa; splunkqa; cd $HOME/gitlab/main/qa/new_test; pip install -U pip; pip install -r requirements.txt; pip install bpython pylint; setupcushy; export REPO=$HOME/gitlab/main/qa; cdr'


if [ ! -d "$HOME/venv" ]; then
    mkdir -p "$(dirname $HOME/venv)"
fi

venv() {

    if (( "$#" < "1" ));
    then
        echo "** Usage: venv <virtualenv name>"
        return 1
    fi

    source "$HOME"/venv/$1/bin/activate
    source "$HOME"/.bashrc
}

####### End Virtualenv ##########

########## pytest ############
# export PYTEST_ADDOPTS="-x --index-wait=0 --browser=chrome"
# export PYTEST_ADDOPTS="-x --browser=chrome"


########### .BASHRC ##########

export ORIG_PATH=$PATH
export PATH_HISTORY=$PWD
export PKG_HOME=$HOME/pkg
export GIT_HOME=$HOME/gitlab
export TEST_DIR=$GIT_HOME/qa/new_test
export SPLUNK_SRC=$GIT_HOME/qa

if [[ -z "$HOSTNAME" ]]
then
    export HOSTNAME=$(hostname)
fi
hostname=$HOSTNAME
export REPO=$GIT_HOME
# echo "hostname is: "$hostname

# Sauce Labs
# - either set or source a file containing the user and key
export SAUCE_USER=
export SAUCE_API_KEY=
[[ -f "$HOME"/.sauce_labs ]] && . "$HOME"/.sauce_labs

# Synergy path

export PATH=$PATH:$HOME/bin/synergy/

# Splunk Perforce alias

# source $HOME/.p4env
# alias p4='p4 login -s &> /dev/null || echo $P4PASSWD | p4 login &> /dev/null; p4 $*'

# MacPorts path variable

export PATH=/opt/local/bin:/opt/local/sbin:$PATH


# Splunk environment variables
[[ -r "$HOME"/.splunk_profile ]] && . "$HOME"/.splunk_profile

# My own bin directory for scripts, etc.
export PATH=$PATH:$HOME/bin/

# PYTHON STARTUP for autocompletion and history.
export PYTHONSTARTUP=$HOME/.pystartup

cd_splunk_src(){
    cd "$SPLUNK_SRC"/"$1" || return
}

cd_splunk_home(){
    cd "$SPLUNK_HOME"/"$1" || return
}

cd_git(){
    cd "$GIT_HOME"/"$1" || return
}

alias setcurrent='setupenv current'
alias cds='cdr; cd $HOME/gitlab/main/qa/new_test'
alias cdg='cd_git'
alias cdl='cds; cd lib/'
alias cdh='cd_splunk_home'
alias cdm='cd $HOME/gitlab/main'
alias cdwd='cds; cd tests/web/webdriver'
alias cdr='cd $REPO'

alias cd='savepath;cd'
alias cdb='pop_savepath;cd $PREV_PATH;pop_savepath'

alias bashrc='. $HOME/.bashrc'
alias ll='ls -lah'

alias splunkstart='$SPLUNK_HOME/bin/splunk start --accept-license --answer-yes'
alias splunksearch='$SPLUNK_HOME/bin/splunk search -auth admin:changeme'
alias splunkhome='echo $SPLUNK_HOME'
alias splunk='$SPLUNK_HOME/bin/splunk'
alias splunkstatus='$SPLUNK_HOME/bin/splunk status; $SPLUNK_HOME/bin/splunk show splunkd-port -auth "admin:changeme"; $SPLUNK_HOME/bin/splunk show web-port -auth "admin:changeme"; $SPLUNK_HOME/bin/splunk show kvstore-port -auth "admin:changeme"; $SPLUNK_HOME/bin/splunk show kvstore-status -auth "admin:changeme"'
alias splunkloglevel='splunk show log-level -auth "admin:changeme" | grep -i -A 1'

splunkseedpasswd(){
    echo "Setting up admin:changeme user..."
    echo "[user_info]\nUSERNAME = admin\nPASSWORD=changeme\n" > "$SPLUNK_HOME"/etc/system/local/user-seed.conf
}


savepath(){
    export PATH_HISTORY="$PWD"':'"$PATH_HISTORY"
    #echo $PATH_HISTORY
}

pwdh(){
    echo "$PATH_HISTORY"
}

pop_savepath(){
    export PREV_PATH=$(echo "$PATH_HISTORY" | cut -d ':' -f 1)
    export PATH_HISTORY=$(echo "$PATH_HISTORY" | cut -d ':' -f 2-)
}

############## Grep #################

# GREP_OPTIONS='--color=auto'
# GREP_COLORS='30;43'
alias grep='grep --color=auto'
# alias rgrep='grep --color=auto -ir'

############## Echo #################

alias envs='env | grep -i'

############## ssh ##################
alias ronnie='ssh glouie@ronnie'
alias wimpy='ssh glouie@wimpy'
alias mrt='ssh glouie@mtr'
alias jenkinsbox='ssh -L 5902:localhost:5902 glouie@qa-jenk-debugging-glouie.sv.splunk.com'


sendsshkey(){

    # note: for it to work you need to make sure perms are right.
    # $ chmod 700 $HOME/.ssh
    # $ chmod 600 $HOME/.ssh/authorized_keys

    if (( "$#" < "1" ));
    then
        echo "** Usage: sendsshkey user@hostname"
        return 1
    fi
    cat "$HOME"/.ssh/id_rsa.pub | ssh "$1" 'cat >> $HOME/.ssh/authorized_keys'
}


############## splunk ##################

alias cdl='cdr; cd new_test/lib'
alias cdt='cdr; cd new_test/tests'

############## misc #################

alias py='/usr/bin/python'
alias rest='curl -k -u admin:changeme -X '
alias rmcasper='sudo /usr/sbin/jamf removeFramework'


# for osx: ex. fnr *.py s/this/that/g
alias fnr='find . -type f -name "{1}" -exec sed -i "" {2} {} +'


############# csv #################
#!/bin/bash 
function printcsv()
{
    awk -F, '{for (i=1;i<=NF;++i) {if (NR>1) val[i] = "$i"; else key[i] = "$i"}} END {for (j=1;j<i;++j) printf("%2d%30s = %s\\n", j, key[j], val[j])}' "$1"
}

############# misc ################

# https://www.sublimetext.com/docs/3/osx_command_line.html
alias subl='/Applications/Sublime\ Text.app/Contents/SharedSupport/bin/subl -a'
alias opensubldir='open $HOME/Library/Application\ Support/Sublime\ Text\ 3/Packages/User/'
alias splinfo='echo "SPLUNK_HOME: $SPLUNK_HOME"; splunk status --accept-license; echo "SPLUNK_SRC: $SPLUNK_SRC"; echo "PYTHONPATH: $PYTHONPATH"'

# VLESS=$(find /usr/local/bin/nvim -name 'less.sh')
# if [ -n "$VLESS" ]; then
#     alias less="$VLESS"
# fi
# export LESSOPEN="| /usr/local/bin/src-hilite-lesspipe.sh %s"
export LESS=" -R"


alias vim='nvim'
alias vi='nvim'

alias rmpyc='find . -name "*.pyc" -print0 | xargs -0 rm'
alias rmlog='find . -name "*.log" -print0 | xargs -0 rm'
alias rmhtml='find . -name "*.html" -print0 | xargs -0 rm'
alias rmxml='find . -name "*.xml" -print0 | xargs -0 rm'
alias rmpng='find . -name "screenshot*.png" -print0 | xargs -0 rm'
alias rmeggs='find . -name "*.egg-info" -print0 | xargs -0 rm -rf'
alias rmtestlogs='rmpyc;rmlog;rmhtml;rmxml;rmpng'

alias pyl='pylint -d "C0103,R0902,R0904,R0801,C0302,W0105,R0913"'

function get_running_splunk_home(){
    process_num=$(ps ax | grep splunkd | grep -v "process-runner" | grep start | awk '{print $1}')
    spl_home=$(ps -E -ww -p "$process_num" | awk -F "SPLUNK_HOME=" '{print $2}' | awk -F " " '{print $1}')
    echo "${spl_home//[$'\t\r\n']}"

}

set2runningsplunk(){
    splhome=$(get_running_splunk_home)
    export SPLUNK_HOME=$splhome
}

stopsplunk(){
    splhome=$(get_running_splunk_home)
    "$splhome"/bin/splunk stop
}

restartsplunk(){
    splhome=$(get_running_splunk_home)
    "$splhome"/bin/splunk restart
}

############## git ###############

function gitcreatebranch(){

    if (( "$#" < "2" ));
    then
        echo "** Usage: gitcreatebranch <new_branch> <upstream_branch>"
        return 1
    fi

    git checkout -b "$1"
    git push -u origin "$1"
    git branch --set-upstream-to="$2" "$1"
}

alias ga='git add'
alias gc='git commit'
alias gd='git diff'
alias gs='git status'
alias gps='git push'
alias gpl='git pull'

##################################

######### pycharm ###############

alias pycharm='/usr/local/bin/charm'

######### shortcuts ###############
alias wtf='open https://confluence.splunk.com/display/PROD/Webdriver+Test+Framework'
# alias jenkin='open https://apps-jenkins.sv.splunk.com/'
# alias jira='open https://jira.splunk.com/browse/'  # use the jira() instead
alias mainrepo='open https://git.splunk.com/projects/SPLCORE/repos/main/qa/browse'
alias okta='open https://splunk.okta.com'
# alias releases='open https://releases.sv.splunk.com'

######## jedi #################
alias installjedivim='cd $HOME/.vim/bundle/ && git clone --recursive https://github.com/davidhalter/jedi-vim.git'
alias installjedi='pip install jedi'

####### vundle ###############
alias installvundle='git clone https://github.com/VundleVim/Vundle.vim.git $HOME/.vim/bundle/Vundle.vim'

####### isplunk ##############
# alias isplunk='cat > /tmp/isplunk.input && isplunk_main -f /tmp/isplunk.input'


####### cushion ##############
# to use backend team cache build server.
# export SPLUNK_CACHED_BUILDS_SERVER=http://health.sv.splunk.com:8080


####### massdrop keyboard ########
# usage: masskbupdate massdrop_ctrl_config_ctrl__default_6087.bin
#
# you will need the mdloader_mac executable
# download here: https://github.com/Massdrop/mdloader/releases
#
# configure keyboard keys here:
#   https://drop.com/mechanical-keyboards/configurator/
#
# TODO: turn this alias to functions, aliases can't use positional params. 
# alias masskbupdate='./mdloader_mac --first --download $1 restart'

# alias samantha='bpython -i ids.py'

####### datf ##############
alias datf='py.test --browser=chrome --html=report.html  --self-contained-html --deployment-type S1 --infra-type=ucp --local-instance --check-crash-logs --action-on-crash=stop --check-splunk-logs'
alias datfrm='py.test --browser=chrome --html=report.html  --self-contained-html --deployment-type S1 --infra-type=ucp --local-instance --diag --check-crash-logs --action-on-crash=stop --check-splunk-logs'
alias datfhl='py.test --browser=chrome --html=report.html  --self-contained-html --chrome-options="--headless" --deployment-type S1 --infra-type=ucp --local-instance --diag --check-crash-logs --action-on-crash=stop --check-splunk-logs'

####### open ##############
function flakyfe () {
    # usage: flakyfe test_something
    open "https://go/flaky-fe/$1"
}

function flakybe () {
    # usage: flakybe test_something
    open "https://go/flaky-be/$1"
}

function jira () {
    # usage: jira spl-12345
    open "https://splunk.atlassian.net/secure/QuickSearch.jspa?searchString=$1"
}

function gitlab () {
    # usage: gitlab hello
    open "https://cd.splunkdev.com/search?search=$1"
}

function splmain () {
    # usage: splmain hello
    # project id 7712 is "main"
    # group id 3228 is "Splunk Core aka splcore"
    open "https://cd.splunkdev.com/search?group_id=3228&project_id=7712&search=$1"
}

function chrome () {
    # chrome <page>
    /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome "$1"
}

# NVM (Node Version Manager)
# Install: 
# curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -f "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm


alias pjson='python -m json.tool'

# TODO: fixme, i don't work in zsh
# function pj () {
#     # python3 - << EOF
#     #     import pprint
#     #     pprint.pprint("""'$args'""")
#     # EOF
#     PYCMD='import pprint; pprint.pprint("""'$@'""")'
#     python -c"$PYCMD"
# }

# ################### Glab ########################
# install: brew install glab
# https://glab.readthedocs.io/en/latest/intro.html
# https://github.com/profclems/glab#installation


####### gitlab #######
export GITLAB_TOKEN=
export GITLAB_FEED_TOKEN=
export GITLAB_PERSONAL_TOKEN=
[[ -f "$HOME"/.gitlab_cred ]] && . "$HOME"/.gitlab_cred
# glab auth login --hostname cd.splunkdev.com --token $GITLAB_TOKEN

alias mymrs='glab mr list --author=@me'


################### vault #######################

# https://developer.hashicorp.com/vault/downloads
# https://developer.hashicorp.com/vault/tutorials/getting-started/getting-started-install
#
# To install
# brew tap hashicorp/tap
# brew install hashicorp/tap/vault

# To update
# brew upgrade hashicorp/tap/vault

export VAULT_ADDR=https://secrets.splunkit.io
export VAULT_NAMESPACE=eeff
# vault login -method=okta username=<USERNAME> (without @splunk.com. Example: psahasrabudhe)

# Enter password and Complete Okta MFA

export VAULT_NAMESPACE=eeff/application
# vault kv list kv_co2_stg
# vault kv get kv_co2_stg/svc-eecq-co2-stg  ---→ store this key on your local machine ( preferably under $HOME/.ssh/id_rsa and change key permissions: chmod 600 <KEY_PATH>)

#################################################

################ scm_breeze  ####################
# https://github.com/scmbreeze/scm_breeze

[ -s "/Users/glouie/.scm_breeze/scm_breeze.sh" ] && source "/Users/glouie/.scm_breeze/scm_breeze.sh"

#################################################
# TODO: need to fix, doesn't work in zsh 
# showcolors ()
# {
#     for i in {0..255}; do print -Pn "%K{$i}  %k%F{$i}${(l:3::0:)i}%f" ${${(M)$((i%6)):#3}:+$'\n'}; done
# }

alias lc='colorls -lA --sd'


################## eza ##########################
# https://github.com/eza-community/eza?tab=readme-ov-file
# eza is an ls alternative tool

if ! type "eza" > /dev/null; then
    if type "brew" > /dev/null; then
        brew install eza
    else
        echo "Can't install eza, because homebrew is not installed."
    fi
else
    alias ls='eza'
    alias ll='eza -alh'
    alias tree='eza --tree'
fi

#################################################

################## bat ##########################
# bat is an less alternative tool

if ! type "bat" > /dev/null; then
    if type "brew" > /dev/null; then
        brew install bat
    else
        echo "Can't install bat, because homebrew is not installed."
    fi
else
    alias less='bat'
    alias cat='bat -p'
fi

#################################################

############## ripgrep ##########################
# ripgrep is an grep alternative tool

if ! type "rg" > /dev/null; then
    if type "brew" > /dev/null; then
        brew install ripgrep
    else
        echo "Can't install ripgrep, because homebrew is not installed."
    fi
# else
#     alias grep='rg'
fi

################################################


################# fzf ##########################
# fzf is a fuzzy finder tool.

if ! type "fzf" > /dev/null; then
    if type "brew" > /dev/null; then
        brew install fzf
    else
        echo "Can't install fzf, because homebrew is not installed."
    fi
fi

################################################


############## Zoxide ##########################
# Zoxide is a cd alternative tool

if ! type "zoxide" > /dev/null; then
    if type "brew" > /dev/null; then
        brew install zoxide
    else
        echo "Can't install zoxide, because homebrew is not installed."
    fi
else
    eval "$(zoxide init --cmd cd zsh)"
fi

################################################

[ -f "$HOME"/.fzf.zsh ] && source "$HOME"/.fzf.zsh

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

p10k_colors () {

    for i in {0..255}; 
    do 
        print -Pn "%K{$i}  %k%F{$i}${(l:3::0:)i}%f " ${${(M)$((i%6)):#3}:+$'\n'}; 
    done
}

eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
